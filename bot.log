2025-05-20 21:53:03,502 - __main__ - INFO - Запуск бота...
2025-05-20 21:53:03,504 - __main__ - INFO - Инициализация бота...
2025-05-20 21:53:03,849 - db - INFO - ✅ Все таблицы и индексы созданы корректно
2025-05-20 21:53:04,317 - bot_core - INFO - Бот успешно запущен
2025-05-20 21:53:31,907 - handlers.base_handlers - ERROR - Ошибка в handle_registered_user: module 'db' has no attribute 'cursor'
Traceback (most recent call last):
  File "/home/user/lunch_bot/handlers/base_handlers.py", line 275, in handle_registered_user
    db.cursor.execute("SELECT is_verified FROM users WHERE telegram_id = ?", (user.id,))
    ^^^^^^^^^
AttributeError: module 'db' has no attribute 'cursor'
2025-05-20 21:53:57,525 - handlers.base_handlers - INFO - Получено сообщение: 'Главное меню' от 361126810
2025-05-20 21:53:57,525 - handlers.base_handlers - ERROR - Ошибка в handle_text_message: module 'db' has no attribute 'cursor'
Traceback (most recent call last):
  File "/home/user/lunch_bot/handlers/base_handlers.py", line 157, in handle_text_message
    if not await check_registration(update, context):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/lunch_bot/utils.py", line 125, in check_registration
    db.cursor.execute("SELECT is_verified FROM users WHERE telegram_id = ?", (user.id,))
    ^^^^^^^^^
AttributeError: module 'db' has no attribute 'cursor'
2025-05-20 21:53:57,820 - handlers.common - ERROR - Ошибка в show_main_menu: module 'db' has no attribute 'cursor'
Traceback (most recent call last):
  File "/home/user/lunch_bot/handlers/base_handlers.py", line 157, in handle_text_message
    if not await check_registration(update, context):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/lunch_bot/utils.py", line 125, in check_registration
    db.cursor.execute("SELECT is_verified FROM users WHERE telegram_id = ?", (user.id,))
    ^^^^^^^^^
AttributeError: module 'db' has no attribute 'cursor'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/user/lunch_bot/handlers/common.py", line 17, in show_main_menu
    db.cursor.execute("SELECT is_verified FROM users WHERE telegram_id = ?", (user_id,))
    ^^^^^^^^^
AttributeError: module 'db' has no attribute 'cursor'
2025-05-20 21:53:59,905 - handlers.base_handlers - ERROR - Ошибка: start expected at most 1 argument, got 2
Traceback (most recent call last):
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_application.py", line 1298, in process_update
    await coroutine
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_handlers/conversationhandler.py", line 842, in handle_update
    new_state: object = await handler.handle_update(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_handlers/basehandler.py", line 158, in handle_update
    return await self.callback(update, context)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: start expected at most 1 argument, got 2
2025-05-20 21:54:24,383 - bot_core - INFO - Бот корректно остановлен
2025-05-20 21:54:24,390 - __main__ - INFO - Приложение завершено
2025-05-20 22:01:25,784 - __main__ - INFO - Запуск бота...
2025-05-20 22:01:25,787 - __main__ - INFO - Инициализация бота...
2025-05-20 22:01:26,442 - db - INFO - ✅ Все таблицы и индексы созданы корректно
2025-05-20 22:01:27,104 - bot_core - INFO - Бот успешно запущен
2025-05-20 22:01:40,716 - handlers.base_handlers - ERROR - Ошибка: start expected at most 1 argument, got 2
Traceback (most recent call last):
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_application.py", line 1298, in process_update
    await coroutine
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_handlers/conversationhandler.py", line 842, in handle_update
    new_state: object = await handler.handle_update(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_handlers/basehandler.py", line 158, in handle_update
    return await self.callback(update, context)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: start expected at most 1 argument, got 2
2025-05-20 22:01:59,599 - bot_core - INFO - Бот корректно остановлен
2025-05-20 22:01:59,606 - __main__ - INFO - Приложение завершено
2025-05-20 22:05:21,417 - __main__ - INFO - Запуск бота...
2025-05-20 22:05:21,418 - __main__ - INFO - Инициализация бота...
2025-05-20 22:05:21,780 - db - INFO - ✅ Все таблицы и индексы созданы корректно
2025-05-20 22:05:22,392 - bot_core - INFO - Бот успешно запущен
2025-05-20 22:05:29,484 - handlers.base_handlers - ERROR - Ошибка: start expected at most 1 argument, got 2
Traceback (most recent call last):
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_application.py", line 1298, in process_update
    await coroutine
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_handlers/conversationhandler.py", line 842, in handle_update
    new_state: object = await handler.handle_update(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_handlers/basehandler.py", line 158, in handle_update
    return await self.callback(update, context)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: start expected at most 1 argument, got 2
2025-05-20 22:05:44,567 - bot_core - INFO - Бот корректно остановлен
2025-05-20 22:05:44,570 - __main__ - INFO - Приложение завершено
2025-05-20 22:18:38,816 - __main__ - INFO - Запуск бота...
2025-05-20 22:18:38,819 - __main__ - INFO - Инициализация бота...
2025-05-20 22:18:39,492 - db - INFO - ✅ Все таблицы и индексы созданы корректно
2025-05-20 22:18:40,610 - bot_core - INFO - Бот успешно запущен
2025-05-20 22:18:45,805 - handlers.base_handlers - ERROR - Ошибка: start expected at most 1 argument, got 2
Traceback (most recent call last):
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_application.py", line 1298, in process_update
    await coroutine
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_handlers/conversationhandler.py", line 842, in handle_update
    new_state: object = await handler.handle_update(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_handlers/basehandler.py", line 158, in handle_update
    return await self.callback(update, context)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: start expected at most 1 argument, got 2
2025-05-20 22:19:12,483 - bot_core - INFO - Бот корректно остановлен
2025-05-20 22:19:12,489 - __main__ - INFO - Приложение завершено
2025-05-20 22:20:46,049 - __main__ - INFO - Запуск бота...
2025-05-20 22:20:46,051 - __main__ - INFO - Инициализация бота...
2025-05-20 22:20:46,398 - db - INFO - ✅ Все таблицы и индексы созданы корректно
2025-05-20 22:20:46,926 - bot_core - INFO - Бот успешно запущен
2025-05-20 22:21:08,861 - handlers.base_handlers - INFO - Получена команда: 'Меню на неделю' от пользователя 361126810
2025-05-20 22:21:08,867 - utils - INFO - Пользователь 361126810 статус верификации: 1
2025-05-20 22:21:15,343 - handlers.order_callbacks - INFO - Пользователь 361126810 отменил заказ на 2025-05-21
2025-05-20 22:21:21,695 - handlers.callback_handlers - INFO - Пользователь 361126810 отменил заказ на 2025-05-21
2025-05-20 22:21:25,625 - handlers.callback_handlers - WARNING - Неизвестный callback: main_menu
2025-05-20 22:21:26,590 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-26'
2025-05-20 22:21:27,918 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-23'
2025-05-20 22:21:29,236 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-23'
2025-05-20 22:21:29,726 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-22'
2025-05-20 22:21:30,873 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-23'
2025-05-20 22:21:31,422 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-26'
2025-05-20 22:21:31,793 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-26'
2025-05-20 22:21:33,570 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-22'
2025-05-20 22:21:34,156 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-23'
2025-05-20 22:21:38,185 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-22'
2025-05-20 22:21:51,174 - handlers.callback_handlers - WARNING - Неизвестный callback: main_menu
2025-05-20 22:21:52,092 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-26'
2025-05-20 22:21:52,878 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-23'
2025-05-20 22:22:09,994 - handlers.base_handlers - INFO - Получена команда: 'Меню на неделю' от пользователя 361126810
2025-05-20 22:22:09,996 - utils - INFO - Пользователь 361126810 статус верификации: 1
2025-05-20 22:22:17,203 - handlers.base_handlers - INFO - Получена команда: '📅 Отчет за месяц' от пользователя 361126810
2025-05-20 22:22:17,205 - utils - INFO - Пользователь 361126810 статус верификации: 1
2025-05-20 22:22:19,961 - handlers.base_handlers - INFO - Получено сообщение: 'Текущий месяц' от 361126810
2025-05-20 22:22:19,962 - utils - INFO - Пользователь 361126810 статус верификации: 1
2025-05-20 22:22:19,984 - report_generators - ERROR - Ошибка формирования админ отчёта: Too early to use font: no default root window
2025-05-20 22:22:23,173 - handlers.base_handlers - INFO - Получена команда: '📊 Отчет за день' от пользователя 361126810
2025-05-20 22:22:23,173 - utils - INFO - Пользователь 361126810 статус верификации: 1
2025-05-20 22:22:23,173 - report_generators - INFO - Создание дневного админ отчета, дата: 2025-05-20
2025-05-20 22:22:23,187 - report_generators - ERROR - Ошибка формирования админ отчёта: Too early to use font: no default root window
2025-05-20 22:22:36,057 - handlers.base_handlers - INFO - Получена команда: 'Просмотреть заказы' от пользователя 361126810
2025-05-20 22:22:36,067 - utils - INFO - Пользователь 361126810 статус верификации: 1
2025-05-20 22:22:37,900 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-22'
2025-05-20 22:22:38,760 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-23'
2025-05-20 22:22:39,003 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-23'
2025-05-20 22:22:39,514 - handlers.callback_handlers - ERROR - Ошибка при отмене заказа: invalid literal for int() with base 10: '2025-05-26'
2025-05-20 22:23:06,846 - admin - INFO - Запрос истории сообщений от 361126810
2025-05-20 22:24:24,336 - handlers.base_handlers - ERROR - Ошибка: start expected at most 1 argument, got 2
Traceback (most recent call last):
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_application.py", line 1298, in process_update
    await coroutine
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_handlers/conversationhandler.py", line 842, in handle_update
    new_state: object = await handler.handle_update(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/lunch_bot/venv/lib/python3.12/site-packages/telegram/ext/_handlers/basehandler.py", line 158, in handle_update
    return await self.callback(update, context)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: start expected at most 1 argument, got 2
2025-05-20 22:24:34,027 - handlers.base_handlers - INFO - Получена команда: 'Обновить меню' от пользователя 361126810
2025-05-20 22:24:34,027 - utils - INFO - Пользователь 361126810 статус верификации: 1
2025-05-20 22:25:04,169 - bot_core - INFO - Бот корректно остановлен
2025-05-20 22:25:04,176 - __main__ - INFO - Приложение завершено
2025-05-20 22:52:55,213 - __main__ - INFO - Запуск бота...
2025-05-20 22:52:55,216 - __main__ - INFO - Инициализация бота...
2025-05-20 22:52:55,578 - db - INFO - ✅ Все таблицы и индексы созданы корректно
2025-05-20 22:52:56,152 - bot_core - INFO - Бот успешно запущен
2025-05-20 22:53:02,415 - handlers.base_handlers - INFO - Получена команда: 'Меню на неделю' от пользователя 361126810
2025-05-20 22:53:02,415 - utils - INFO - Пользователь 361126810 статус верификации: 1
2025-05-20 22:53:07,672 - handlers.callback_handlers - INFO - Пользователь 361126810 отменил заказ на 2025-05-21
2025-05-20 22:53:09,714 - handlers.callback_handlers - INFO - Пользователь 361126810 отменил заказ на 2025-05-26
2025-05-20 22:53:11,749 - handlers.callback_handlers - INFO - Пользователь 361126810 отменил заказ на 2025-05-23
2025-05-20 22:53:13,567 - handlers.callback_handlers - WARNING - Неизвестный callback: main_menu
2025-05-20 22:53:17,302 - handlers.callback_handlers - WARNING - Неизвестный callback: main_menu
2025-05-20 22:53:26,961 - handlers.order_callbacks - ERROR - Ошибка в handle_change_callback: 'NoneType' object is not subscriptable
Traceback (most recent call last):
  File "/home/user/lunch_bot/handlers/order_callbacks.py", line 126, in handle_change_callback
    current_qty = db.cursor.fetchone()[0]
                  ~~~~~~~~~~~~~~~~~~~~^^^
TypeError: 'NoneType' object is not subscriptable
2025-05-20 22:53:29,444 - handlers.order_callbacks - ERROR - Ошибка в handle_change_callback: 'NoneType' object is not subscriptable
Traceback (most recent call last):
  File "/home/user/lunch_bot/handlers/order_callbacks.py", line 126, in handle_change_callback
    current_qty = db.cursor.fetchone()[0]
                  ~~~~~~~~~~~~~~~~~~~~^^^
TypeError: 'NoneType' object is not subscriptable
2025-05-20 22:53:30,835 - handlers.order_callbacks - ERROR - Ошибка в handle_change_callback: 'NoneType' object is not subscriptable
Traceback (most recent call last):
  File "/home/user/lunch_bot/handlers/order_callbacks.py", line 126, in handle_change_callback
    current_qty = db.cursor.fetchone()[0]
                  ~~~~~~~~~~~~~~~~~~~~^^^
TypeError: 'NoneType' object is not subscriptable
2025-05-20 22:53:37,874 - handlers.base_handlers - INFO - Получена команда: 'Меню на неделю' от пользователя 361126810
2025-05-20 22:53:37,874 - utils - INFO - Пользователь 361126810 статус верификации: 1
2025-05-20 22:53:45,544 - handlers.order_callbacks - INFO - Пользователь 361126810 отменил заказ на 2025-05-22
2025-05-20 22:53:52,190 - handlers.callback_handlers - INFO - Пользователь 361126810 отменил заказ на 2025-05-21
2025-05-20 22:54:00,733 - handlers.order_callbacks - INFO - Пользователь 361126810 отменил заказ на 2025-05-22
2025-05-20 22:54:14,730 - handlers.base_handlers - INFO - Получена команда: '📅 Отчет за месяц' от пользователя 361126810
2025-05-20 22:54:14,732 - utils - INFO - Пользователь 361126810 статус верификации: 1
2025-05-20 22:54:18,556 - handlers.base_handlers - INFO - Получено сообщение: 'Текущий месяц' от 361126810
2025-05-20 22:54:18,557 - utils - INFO - Пользователь 361126810 статус верификации: 1
2025-05-20 22:54:18,585 - report_generators - ERROR - Ошибка формирования админ отчёта: Too early to use font: no default root window
2025-05-20 22:54:35,655 - bot_core - INFO - Бот корректно остановлен
2025-05-20 22:54:35,659 - __main__ - INFO - Приложение завершено
